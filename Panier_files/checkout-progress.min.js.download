var Checkout=Class.create(),Billing=(Checkout.prototype={initialize:function(params,urls){this.sections=$$("#"+params.nodeParent+" "+params.stepClass),this.progressUrl=urls.progress,this.reviewUrl=urls.review,this.saveMethodUrl=urls.saveMethod,this.failureUrl=urls.failure,this.pingUrl=urls.ping,this.loginUrl=urls.login,this.resetAddress=urls.resetAddress,this.billingForm=!1,this.shippingForm=!1,this.syncBillingShipping=!1,this.method="",this.payment="",this.loadWaiting=!1,this.steps=["cart","login","billing","shipping","shipping_method","payment","review"],this.stepsHistory=["cart","login","billing","shipping_method","payment","review"],window.innerDocClick=!0,this.stepsData={cart:{state:"cart",step:"cart",title:Translator.translate("checkout.cart.header.step.cart"),step_number:1},login:{state:"login",step:"login",title:Translator.translate("My account"),step_number:2},billing:{state:"billing",step:"billing",title:Translator.translate("My billing"),step_number:3},shipping_method:{state:"shipping_method",step:"shipping_method",title:Translator.translate("My shipping method"),step_number:4},payment:{state:"payment",step:"payment",title:Translator.translate("My payment"),step_number:5},review:{state:"review",step:"review",title:Translator.translate("My review"),step_number:6}},this.submitButtonLabels=params.submitButtonLabels,this.isOmnipharTagEnabled=params.isOmnipharTagEnabled,this.CUSTOMER_ID=params.CUSTOMER_ID,this.latestHostedFieldsBtnsWereDisabled=null,this.hostedFieldsSubmitButtonsHaveAlreadyLoad=!1,this._refreshStepView(params.currentStep||"billing"),this.sections.each(function(section,row){Event.observe($(section),"click",this._onSectionClick.bind(this))}.bind(this)),"login"!==this.currentStep&&"billing"!=this.currentStep||(urls=this.stepsData[this.currentStep],window.history.pushState(urls,"",urls.step),document.title=urls.title),window.onpopstate=function(e){var lastUrlPart;window.innerDocClick||(lastUrlPart=document.URL.split("/").pop(),this.stepsHistory.indexOf(this.currentStep)-this.stepsHistory.indexOf(lastUrlPart)&&this.gotoSection(lastUrlPart,!0,!1))}.bind(this)},_onSectionClick:function(event){var section=event.currentTarget;if(section.hasClassName("allow"))return Event.stop(event),this.gotoSection(section.readAttribute("id").replace("opc-",""),!0),!1},_refreshStepView:function(section){var previousStep="";switch(section){case"payment":previousStep="shipping_method";break;case"review":previousStep="payment"}var indexCurrentStep,data=this.stepsData[section];""!==previousStep&&(data.previousStep=this.stepsData[previousStep]),jQuery(document.getElementById("main-content")).trigger("checkout.init_step",data),section&&(this.currentStep=section,document.body.classList.forEach(classname=>{classname.startsWith("onepage-checkout-")&&document.body.classList.remove(classname)}),document.body.classList.add("onepage-checkout-"+this.currentStep),indexCurrentStep=this.steps.indexOf(this.currentStep),this.steps.each(function(step,row){this.switchStep(step,row<=indexCurrentStep)}.bind(this)),this.setSummaryButton())},payWithHostedFields(e){window.payment.payWithHostedFields(e)},payWithPayzenStandardRest(e){window.payment.payWithPayzenStandardRest(e)},setSummaryButton:function(reset){if("login"!==this.currentStep){var buttons=document.querySelectorAll(".checkout-cart-button-submit a.button"),buttonsArray=Array.from(buttons),buttonsArray=(buttonsArray.some(b=>b.classList.contains("hf"))&&(this.latestHostedFieldsBtnsWereDisabled=buttonsArray.some(b=>b.classList.contains("disabled"))),document.querySelector('.payment-methods .method.selected input[name="payment[method]"]')),selectedPaymentMethodIsHipayHostedFields="hipay_hostedfields"===buttonsArray?.dataset.paymentMethodId,selectedPaymentMethodIsPayzenStandard="payzen_standard_rest"===buttonsArray?.dataset.paymentMethodId,useOneClick=document.querySelector('input[name="payment[hipay_hostedfields_oneclick]"]')?.checked;if(!selectedPaymentMethodIsHipayHostedFields||"payment"!==this.currentStep||!1!==reset&&void 0!==reset||useOneClick)if(!selectedPaymentMethodIsPayzenStandard||"payment"!==this.currentStep||!1!==reset&&void 0!==reset){let label=window.config?.checkoutConfigData?.checkout?.translations?.summarySubmit[this.currentStep]||this.submitButtonLabels[this.currentStep];"payment"===this.currentStep&&(selectedPaymentMethodIsHipayHostedFields||selectedPaymentMethodIsPayzenStandard||["checkmo","banktransfer"].includes(buttonsArray?.dataset.paymentMethodId))&&(label=""+Translator.translate("checkout_onepage.review.summary.submit")),buttons.forEach(button=>{button.classList.remove("disabled","hf","pz");var new_element=button.cloneNode(!0);new_element&&(new_element.innerHTML=label,new_element.setAttribute("aria-label",label),new_element.addEventListener("click",this.onSummarySubmit),button.parentNode.replaceChild(new_element,button))})}else buttons.forEach(button=>{button.classList.remove("disabled","hf");var new_element=button.cloneNode(!0);new_element&&(new_element.innerHTML=""+Translator.translate("checkout.cart.total.validate.pay"),new_element.addEventListener("click",this.payWithPayzenStandardRest),button.parentNode?.replaceChild(new_element,button))});else buttons.forEach(button=>{button.classList.remove("disabled","pz");var new_element=button.cloneNode(!0);new_element&&(!this.hostedFieldsSubmitButtonsHaveAlreadyLoad||this.latestHostedFieldsBtnsWereDisabled?new_element.classList.add("disabled"):new_element.classList.remove("disabled"),new_element.innerHTML=""+Translator.translate("checkout.cart.total.validate.pay"),new_element.classList.add("hf"),new_element.addEventListener("click",this.payWithHostedFields),button.parentNode?.replaceChild(new_element,button),this.hostedFieldsSubmitButtonsHaveAlreadyLoad=!0)})}},onSummarySubmit:function(){switch(checkout.currentStep){case"billing":return billing.save();case"shipping_method":return shippingMethod.continue();case"payment":return payment.save();case"review":return review.save()}},changeTitlePage:function(){var currentStepTitle=jQuery("#checkoutSteps .active:last h2").text(),titlePage=jQuery("h1");"review"===this.currentStep&&(currentStepTitle=jQuery("#checkoutSteps #opc-review h2").text()),titlePage.text(currentStepTitle)},switchStep:function(step,isEnable){var sectionElement,nodeCurrentCheckoutStep;void 0!==step&&(sectionElement=$("opc-"+step),nodeCurrentCheckoutStep=$("checkout-step-"+step),sectionElement)&&(isEnable?sectionElement.addClassName("allow"):sectionElement.removeClassName("allow"),nodeCurrentCheckoutStep)&&(this.currentStep===step?((isEnable=document.getElementById("html-checkout-loader"))&&isEnable.remove(),"review"!==step&&(nodeCurrentCheckoutStep.style.display="block"),(isEnable=document.getElementById("checkout-wrapper"))&&(isEnable.style.visibility="visible"),"login"!==step&&(isEnable=document.getElementsByClassName("nav-checkout")[0])&&isEnable.classList.add("visible"),"review"===step&&(Omniphar.loader.show({message:Translator.translate("loader.message.review")}),$("checkout-step-payment").style.display="block",sectionElement=$("opc-payment")),sectionElement.addClassName("active")):(nodeCurrentCheckoutStep.style.display="none",sectionElement.removeClassName("active")),this.changeTitlePage())},ajaxFailure:function(){location.href=this.failureUrl},reloadProgressBlock:function(toStep){},reloadStep:function(prevStep){},reloadProgress:async function(){this.loadWaiting||this.setLoadWaiting("default");const url=new URL(this.progressUrl);var data,element;for(const request of await Promise.all(["billing","shipping_method","summary","payment"].map(item=>(url.search=new URLSearchParams({prevStep:item}).toString(),fetch(url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}})))))request.ok&&(data=await request.text(),element=document.getElementById(new URL(request.url).searchParams.get("prevStep")+"-progress-opcheckout"))&&(element.innerHTML=data);"function"==typeof window.HiPay&&window.payment.resetHostedFields(),checkout.setSummaryButton(),this.loadWaiting&&this.setLoadWaiting(!1)},reloadReviewBlock:function(){new Ajax.Updater("checkout-review-load",this.reviewUrl,{method:"post",onFailure:this.ajaxFailure.bind(this)})},_disableEnableAll:function(element,isDisabled){var k,descendants=element.descendants();for(k in descendants)descendants[k].disabled=isDisabled;element.disabled=isDisabled},setLoadWaiting:function(_step){if(_step&&"undefined"!=typeof Omniphar&&"object"==typeof Omniphar.loader&&"function"==typeof Omniphar.loader.show){switch(_step){case"billing":Omniphar.loader.show({message:Translator.translate("loader.message.billing")});break;case"shipping-method":Omniphar.loader.show({message:Translator.translate("loader.message.shipping-method")});break;case"payment":Omniphar.loader.show({message:Translator.translate("loader.message.payment")});break;case"review":Omniphar.loader.show({message:Translator.translate("loader.message.review")});break;case"hostedfields":Omniphar.loader.show({message:Translator.translate("loader.message.hostedfields")});break;case"scalapay":Omniphar.loader.show({message:Translator.translate("loader.message.scalapay")});break;case"paypal":Omniphar.loader.show({message:Translator.translate("loader.message.paypal")});break;default:Omniphar.loader.show({message:Translator.translate("loader.message.default")})}this.loadWaiting&&"hostedfields"!==_step&&this.setLoadWaiting(!1)}else this.loadWaiting&&"undefined"!=typeof Omniphar&&"object"==typeof Omniphar.loader&&"function"==typeof Omniphar.loader.hide&&Omniphar.loader.hide();this.loadWaiting=_step},gotoSection:function(section,reloadProgressBlock,_updateUrl){var grandPrice,cartProgressPrice,_updateUrl=void 0===_updateUrl||_updateUrl;"cart"===section?window.location.href="/checkout/cart/":("review"==this.currentStep&&(payment.form="co-payment-form"),cartProgressPrice=jQuery("h3.complete").find(".number"),"payment"==this.currentStep&&"shipping_method"!=section?(grandPrice=" - "+jQuery("#cart-grand-total").text().split(":")[1],cartProgressPrice.text(grandPrice)):"payment"!=section&&cartProgressPrice.text(""),"login"!=this.currentStep&&"billing"!=this.currentStep||"billing"!=section||jQuery("body").addClass("opc-has-progressed-from-login"),reloadProgressBlock&&_updateUrl&&(grandPrice=this.stepsData[section],window.history.pushState(grandPrice,"",grandPrice.step),document.title=grandPrice.title),cartProgressPrice=new CustomEvent("onepageCheckoutStepChange",{detail:{to:section,from:this.currentStep}}),document.dispatchEvent(cartProgressPrice),this._refreshStepView(section),"shipping_method"==section&&window.shippingMethod.listenToShippingMethodClick(),"payment"==section&&window.payment.listenToPaymentMethodClick(),goTo())},resetPreviousSteps:function(){for(var i=this.steps.indexOf(this.currentStep)+1;i<this.steps.length;i++){var progressDiv=this.steps[i]+"-progress-opcheckout";$(progressDiv)&&($(progressDiv).select("h3 a").each(function(item){item.remove()}),$(progressDiv).select("h3").each(function(item){item.removeClassName("complete")}),$(progressDiv).select(".description").each(function(item){item.remove()}))}},changeSection:function(section){section=section.replace("opc-","");this.gotoSection(section,!0)},setMethod:function(){if($("login:guest")&&$("login:guest").checked){this.method="guest";new Ajax.Request(this.saveMethodUrl,{method:"post",onFailure:this.ajaxFailure.bind(this),parameters:{method:"guest"}});Element.hide("register-customer-password")}else{if(!$("login:register")||!$("login:register").checked&&"hidden"!=$("login:register").type)return alert(Translator.translate("Please choose to register or to checkout as a guest").stripTags()),!1;this.method="register";new Ajax.Request(this.saveMethodUrl,{method:"post",onFailure:this.ajaxFailure.bind(this),parameters:{method:"register"}});Element.show("register-customer-password")}this.gotoSection("billing",!0),document.body.fire("login:setMethod",{method:this.method})},setBilling:function(){$("billing:use_for_shipping_yes")&&$("billing:use_for_shipping_yes").checked?(shipping.syncWithBilling(),$("opc-shipping").addClassName("allow"),this.gotoSection("shipping_method",!0)):($("billing:use_for_shipping_no")&&$("billing:use_for_shipping_no").checked?document.getElementById("shipping:same_as_billing").checked=!1:document.getElementById("shipping:same_as_billing").checked=!0,this.gotoSection("shipping",!0))},setShipping:function(){this.gotoSection("shipping_method",!0)},setShippingMethod:function(){this.gotoSection("payment",!0)},setPayment:function(){this.gotoSection("review",!0)},setReview:function(){this.reloadProgressBlock()},back:function(){if(!this.loadWaiting){for(var stepIndex=this.steps.indexOf(this.currentStep),section=this.steps[--stepIndex],sectionElement=$("opc-"+section);null===sectionElement&&0<stepIndex;)section=this.steps[--stepIndex],sectionElement=$("opc-"+section);this.changeSection("opc-"+section),goTo()}},fixCurrentAddressSelection:function(){new Ajax.Request(this.resetAddress,{method:"post",onComplete:function(data){$("billing-progress-opcheckout").update(data.responseText)}})},setStepResponse:function(response){return response.update_section&&$("checkout-"+response.update_section.name+"-load").update(response.update_section.html),response.allow_sections&&response.allow_sections.each(function(e){$("opc-"+e).addClassName("allow")}),response.duplicateBillingInfo&&(this.syncBillingShipping=!0,shipping.setSameForBilling(!0)),"object"==typeof response.dataLayer&&"object"==typeof window.dataLayer&&window.dataLayer.push(response.dataLayer),response.goto_section?(this.gotoSection(response.goto_section,!0),!0):!!response.redirect&&(response=response.redirect,(location.href=response)?.include("scalapay")?checkout.setLoadWaiting("scalapay"):!response?.include("paypal")||checkout.setLoadWaiting("paypal"))}},Class.create()),Shipping=(Billing.prototype={initialize:async function(form,addressUrl,saveUrl){this.form=form,$(this.form)&&$(this.form).observe("submit",function(event){this.save(),Event.stop(event)}.bind(this)),this.addressUrl=addressUrl,this.saveUrl=saveUrl,this.onAddressLoad=this.fillForm.bindAsEventListener(this),this.onSave=await this.nextStep.bindAsEventListener(this),this.onChangeAddress()},setAddress:function(addressId){addressId?request=new Ajax.Request(this.addressUrl+addressId,{method:"post",onSuccess:this.onAddressLoad,onFailure:checkout.ajaxFailure.bind(checkout)}):this.fillForm(!1)},displayAddress:function(){var container,addressId,addressDisplay;null!==document.getElementById("billing-address-select")&&null!==document.getElementById("billing-adress-display")&&null!==document.getElementById("billing-address-display")&&(container=$("billing-adress-display"),addressId=$("billing-address-select").value,(addressDisplay=$("billing-address-display"))instanceof HTMLElement&&addressDisplay.show(),content="FR"==addresses[addressId].country?"<span>"+addresses[addressId].label+'</span><p class="fr-exeption"> *Si vous souhaitez être livré en point Relais, vous pourrez le préciser à l\'étape livraison</p>':"<span>"+addresses[addressId].label+"</span>",container.update(content))},onChangeAddress:function(){var addressSelect=$("billing-address-select");addressSelect&&(""==addressSelect.value?this.newAddress():(Element.hide("billing-new-address-form"),this.displayAddress()))},newAddress:function(isNew){this.resetSelectedAddress(),Element.show("billing-new-address-form"),$("billing-adress-display").update(""),$("billing-address-display").hide()},resetSelectedAddress:function(){var selectElement=$("billing-address-select");selectElement&&(selectElement.value="")},fillForm:function(transport){var elementValues={},elemIndex,fieldName;if(transport&&transport.responseText)try{elementValues=eval("("+transport.responseText+")")}catch(e){elementValues={}}else this.resetSelectedAddress();for(elemIndex in arrElements=Form.getElements(this.form),arrElements){arrElements[elemIndex].id&&(fieldName=arrElements[elemIndex].id.replace(/^billing:/,""),arrElements[elemIndex].value=elementValues[fieldName]||"","country_id"==fieldName)&&billingForm&&billingForm.elementChildLoad(arrElements[elemIndex])}},useShippingAddress:function(flag){flag?(document.getElementById("shipping:same_for_billing").checked=!0,$("show-billing").checked=!1,$("billing-part-form").hide(),this.syncWithShipping(),this.displayAddress()):(document.getElementById("shipping:same_for_billing").checked=!1,$("show-billing").checked=!0,$("billing-part-form").show(),this.onChangeAddress())},setUseForShipping:function(flag){document.getElementById("shipping:same_for_billing").checked=flag,$("show-billing").checked=!flag},syncWithShipping:function(){for(var elemIndex in arrElements=Form.getElements(this.form)){var sourceField;arrElements[elemIndex].id&&"billing"==arrElements[elemIndex].id.substr(0,7)&&(sourceField=$(arrElements[elemIndex].id.replace(/^billing/,"shipping")))&&(arrElements[elemIndex].value=sourceField.value)}billingRegionUpdater.update(),$("billing:region_id").value=$("shipping:region_id").value,$("billing:region").value=$("shipping:region").value},save:function(){if($("shipping:same_for_billing").checked&&this.syncWithShipping(),0==checkout.loadWaiting){try{var PhoneComponent=window.document.getReactComponent("Phone");PhoneComponent?.makeInputInternational("billing:telephone"),PhoneComponent?.makeInputInternational("shipping:telephone")}catch(e){console.error(e.message)}new Validation(this.form).validate()&&(checkout.setLoadWaiting("billing"),void 0!==document.getElementById(this.form).elements["g-website-key"]?grecaptcha.enterprise.ready(function(){grecaptcha.enterprise.execute(document.getElementById(this.form).elements["g-website-key"].value,{action:document.getElementById(this.form).elements["g-action-name"].value}).then(function(token){document.getElementById(this.form).elements["g-recaptcha-response"].value=token;new Ajax.Request(this.saveUrl,{method:"post",onComplete:this.onComplete,onSuccess:this.onSave,onFailure:checkout.ajaxFailure.bind(checkout),parameters:Form.serialize(this.form)})}.bind(this))}.bind(this)):new Ajax.Request(this.saveUrl,{method:"post",onComplete:this.onComplete,onSuccess:this.onSave,onFailure:checkout.ajaxFailure.bind(checkout),parameters:Form.serialize(this.form)})),omnipharAnalyticSaveShippingAddress&&checkout.isOmnipharTagEnabled&&checkout.CUSTOMER_ID&&omnipharAnalyticSaveShippingAddress(checkout.CUSTOMER_ID)}},resetLoadWaiting:function(transport){checkout.setLoadWaiting(!1),document.body.fire("billing-request:completed",{transport:transport})},nextStep:async function(transport){if(transport&&transport.responseText)try{response=eval("("+transport.responseText+")")}catch(e){response={}}if(void 0!==transport.responseJSON.dataLayer.account_created){let eventName="sign_up_failed";transport.responseJSON.dataLayer.account_created&&(eventName="sign_up"),document.dispatchEvent(new CustomEvent("push_sign_gtm_event",{detail:eventName}))}if(response.error)return"string"==typeof response.message?alert(response.message):(window.billingRegionUpdater&&billingRegionUpdater.update(),alert(response.message.join("\n"))),checkout.setLoadWaiting(!1),!1;await checkout.reloadProgress(),checkout.setStepResponse(response)}},Class.create()),ShippingMethod=(Shipping.prototype={initialize:function(form,addressUrl,saveUrl,methodsUrl){this.form=form,$(this.form)&&$(this.form).observe("submit",function(event){this.save(),Event.stop(event)}.bind(this)),this.addressUrl=addressUrl,this.saveUrl=saveUrl,this.methodsUrl=methodsUrl,this.onAddressLoad=this.fillForm.bindAsEventListener(this),this.onSave=this.nextStep.bindAsEventListener(this),this.onComplete=this.resetLoadWaiting.bindAsEventListener(this),this.handleCountryAndZipValidation()},handleCountryAndZipValidation:function(){this.onChangeAddress();for(var countrySelectArray=document.querySelectorAll(".select-country select"),i=0,len=countrySelectArray.length;i<len;i++)Omniphar.form.changeZipCode(countrySelectArray[i]),jQuery(countrySelectArray[i]).on("change",function(){Omniphar.form.changeZipCode(this)})},setAddress:function(addressId){addressId?request=new Ajax.Request(this.addressUrl+addressId,{method:"post",onSuccess:this.onAddressLoad,onFailure:checkout.ajaxFailure.bind(checkout)}):this.fillForm(!1)},displayAddress:function(){var container,addressId,addressDisplay;null!==document.getElementById("shipping-address-select")&&null!==document.getElementById("shipping-adress-display")&&null!==document.getElementById("shipping-address-display")&&(container=$("shipping-adress-display"),addressId=$("shipping-address-select").value,(addressDisplay=$("shipping-address-display"))instanceof HTMLElement&&addressDisplay.show(),content="FR"==addresses[addressId].country?"<span>"+addresses[addressId].label+'</span><p class="fr-exeption"> *Si vous souhaitez être livré en point Relais, vous pourrez le préciser à l\'étape livraison</p>':"<span>"+addresses[addressId].label+"</span>",container.update(content))},onChangeAddress:function(){var addressSelect=$("shipping-address-select");addressSelect&&(""==addressSelect.value?this.newAddress():(Element.hide("shipping-new-address-form"),this.displayAddress()))},newAddress:function(isNew){this.resetSelectedAddress(),Element.show("shipping-new-address-form"),$("shipping-adress-display").update(""),$("shipping-address-display").hide(),shipping.setSameAsBilling(!1)},resetSelectedAddress:function(){var selectElement=$("shipping-address-select");selectElement&&(selectElement.value="")},fillForm:function(transport){var elementValues={},elemIndex,fieldName;if(transport&&transport.responseText)try{elementValues=eval("("+transport.responseText+")")}catch(e){elementValues={}}else this.resetSelectedAddress();for(elemIndex in arrElements=Form.getElements(this.form),arrElements){arrElements[elemIndex].id&&(fieldName=arrElements[elemIndex].id.replace(/^shipping:/,""),arrElements[elemIndex].value=elementValues[fieldName]||"","country_id"==fieldName)&&shippingForm&&shippingForm.elementChildLoad(arrElements[elemIndex])}},setSameAsBilling:function(flag){flag&&(this.syncWithBilling(),$("billing-part-form").hide())},hideBillingForm:function(flag){flag&&$("billing-part-form").show()},syncWithBilling:function(){if($("shipping:same_for_billing").checked=!0,$("billing-address-select")&&$("billing-address-select").value)$("billing-address-select").value=$("shipping-address-select").value;else{for(var elemIndex in arrElements=Form.getElements(this.form)){var sourceField;arrElements[elemIndex].id&&(sourceField=$(arrElements[elemIndex].id.replace(/^shipping:/,"billing:")))&&(arrElements[elemIndex].value=sourceField.value)}shippingRegionUpdater.update(),$("shipping:region_id").value=$("billing:region_id").value,$("shipping:region").value=$("billing:region").value,$("billing-part-form").show()}},setRegionValue:function(){$("shipping:region").value=$("billing:region").value},save:function(){if(0==checkout.loadWaiting){try{window.document.getReactComponent("Phone")?.makeInputInternational("shipping:telephone")}catch(e){console.error(e.message)}new Validation(this.form).validate()&&(checkout.setLoadWaiting("shipping"),new Ajax.Request(this.saveUrl,{method:"post",onComplete:this.onComplete,onSuccess:this.onSave,onFailure:checkout.ajaxFailure.bind(checkout),parameters:Form.serialize(this.form)}))}},resetLoadWaiting:function(transport){checkout.setLoadWaiting(!1)},nextStep:function(transport){if(transport&&transport.responseText)try{response=eval("("+transport.responseText+")")}catch(e){response={}}if(response.error)return"string"==typeof response.message?alert(response.message):(window.shippingRegionUpdater&&shippingRegionUpdater.update(),alert(response.message.join("\n"))),!1;checkout.setStepResponse(response)}},Class.create()),Payment=(ShippingMethod.prototype={initialize:function(form,saveUrl){this.form=form,$(this.form)&&$(this.form).observe("submit",function(event){this.save(),Event.stop(event)}.bind(this)),this.saveUrl=saveUrl,this.validator=new Validation(this.form),this.onSave=this.nextStep.bindAsEventListener(this),this.onComplete=this.resetLoadWaiting.bindAsEventListener(this),this.checkedShippingMethodInputBeforeClick=null,this.currentShippingMethodCheckedInput=null,this.pickupInfoBeforeClick=null,this.listenToShippingMethodClick()},continue:function(){checkout.loadWaiting||this.validate()&&(checkout.isOmnipharTagEnabled&&omnipharAnalyticSaveShippingMethod(),this.resetLoadWaiting.bindAsEventListener(this),checkout.gotoSection("payment",!0))},listenToShippingMethodClick:function(){const items=document.querySelectorAll("ul.shipping-methods .list-item");items.forEach(item=>{const input=item.querySelector("input.input-radio"),_this=(this.isSocollisimo(input)&&item.classList.add("isPickup"),input.checked&&(this.checkedShippingMethodInputBeforeClick=input,this.currentShippingMethodCheckedInput=input),this);item.classList.contains("has-click-listener")||(item.classList.add("has-click-listener"),item.addEventListener("click",function(){_this.handleClickedShippingMethod(items,item,input)}))})},handleClickedShippingMethod:function(items,clickedItem,clickedItemInput){this.checkedShippingMethodInputBeforeClick=this.currentShippingMethodCheckedInput,(this.currentShippingMethodCheckedInput=clickedItemInput).checked=!0,this.resetPickupInfoInItemsList(),items.forEach(item=>{item===clickedItem?item.classList.add("selected"):item.classList.contains("selected")&&item.classList.remove("selected")}),this.isSocollisimo(clickedItemInput)?this.handleSocolissimo(clickedItem,clickedItemInput):this.save()},setPickupInfoInItemsList:function(data){var selectedItem=this.currentShippingMethodCheckedInput.parentElement.parentElement.parentElement.parentElement;if(selectedItem){let dataElement=selectedItem.getElementsByClassName("pickup-data");(dataElement=dataElement.length?dataElement[0]:dataElement).innerHTML=data.trim(),this.pickupInfoBeforeClick=dataElement.innerHTML}},resetPickupInfoInItemsList:function(){document.querySelectorAll(".pickup-data").forEach(pickup=>{""!==pickup.innerHTML&&(this.pickupInfoBeforeClick=pickup.innerHTML),pickup.innerHTML=""})},isSocollisimo:input=>input.id.includes("socolissimo"),handleSocolissimo:function(clickedItem,clickedItemInput){clickedItemInput.checked=!1,window.shippingMethod.ScPopup.open(920,595),window.shippingMethod.scLoadContent("methods",{shipping_method:clickedItemInput.value})},resetShippingMethodListToPreviousState:function(){this.checkedShippingMethodInputBeforeClick&&document.body.contains(this.checkedShippingMethodInputBeforeClick)?(this.checkedShippingMethodInputBeforeClick.checked=!0,this.checkedShippingMethodInputBeforeClick!==this.currentShippingMethodCheckedInput&&(this.checkedShippingMethodInputBeforeClick.closest("li.method").classList.add("selected"),this.currentShippingMethodCheckedInput.checked=!1,this.currentShippingMethodCheckedInput.closest("li.method").classList.remove("selected"),this.currentShippingMethodCheckedInput=this.checkedShippingMethodInputBeforeClick,this.save("default")),this.setPickupInfoInItemsList(this.pickupInfoBeforeClick)):(this.currentShippingMethodCheckedInput.checked=!1,this.currentShippingMethodCheckedInput.closest("li.method").classList.remove("selected"),this.setPickupInfoInItemsList(this.pickupInfoBeforeClick),this.currentShippingMethodCheckedInput=this.checkedShippingMethodInputBeforeClick)},validate:function(){var methods=document.getElementsByName("shipping_method");if(0==methods.length)alert(Translator.translate("Your order cannot be completed at this time as there is no shipping methods available for it. Please make necessary changes in your shipping address.").stripTags());else if(this.validator.validate()){for(var i=0;i<methods.length;i++)if(methods[i].checked)return!0;alert(Translator.translate("Please specify shipping method.").stripTags())}return!1},save:function(message){message=message||"shipping-method",checkout.loadWaiting||this.validate()&&(checkout.setLoadWaiting(message),new Ajax.Request(this.saveUrl,{method:"post",onSuccess:this.onSave,onFailure:checkout.ajaxFailure.bind(checkout),parameters:Form.serialize(this.form)}))},resetLoadWaiting:function(transport){checkout.setLoadWaiting(!1)},nextStep:function(transport){if(transport&&transport.responseText)try{response=eval("("+transport.responseText+")")}catch(e){response={}}if(response.error)return alert(response.message),!1;checkout.stepsData[checkout.currentStep].selected_option=$(this.form).shipping_method.value;let data=checkout.stepsData[checkout.currentStep];document.dispatchEvent(new CustomEvent("push_checkout_gtm_event",{detail:{data:data,event:"shipping_method_selected"}})),response.update_section&&$("checkout-"+response.update_section.name+"-load").update(response.update_section.html),"object"==typeof response.dataLayer&&"object"==typeof window.dataLayer&&window.dataLayer.push(response.dataLayer),response.goto_section&&checkout.reloadProgress()}},Class.create()),Review=(Payment.prototype={initialize:async function(form,saveUrl){this.form=form,$(this.form)&&$(this.form).observe("submit",function(event){this.save(),Event.stop(event)}.bind(this)),this.saveUrl=saveUrl,this.validator=new Validation(this.form),this.onSave=await this.nextStep.bindAsEventListener(this),this.listenToPaymentMethodClick()},switchMethod:function(method){method&&(this.lastUsedMethod=method),this.currentMethod=method,checkout.stepsData[checkout.currentStep].selected_option=this.currentMethod;method=checkout.stepsData[checkout.currentStep];document.dispatchEvent(new CustomEvent("push_checkout_gtm_event",{detail:{data:method,event:"payment_method_selected"}}))},validate:function(){var methods=document.getElementsByName("payment[method]");if(0==methods.length)alert(Translator.translate("Your order cannot be completed at this time as there is no payment methods available for it.").stripTags());else if(this.validator.validate()){for(var i=0;i<methods.length;i++)if(methods[i].checked)return!0;alert(Translator.translate("Please specify payment method.").stripTags())}return!1},listenToPaymentMethodClick:function(){const items=document.querySelectorAll("ul.payment-methods .list-item");items.forEach(item=>{const input=item.querySelector("input.input-radio"),container=item.querySelector(".line"),_this=this;container.addEventListener("click",function(event){_this.handleClickedPaymentMethod(event,items,container,input)})})},handleClickedPaymentMethod:function(event,items,clickedItem,clickedItemInput){clickedItemInput.checked=!0;const selectedPaymentMethodIsHipayHostedFields="hipay_hostedfields"===clickedItemInput?.dataset.paymentMethodId,selectedPaymentMethodIsPayzenStandardRest="payzen_standard_rest"===clickedItemInput?.dataset.paymentMethodId;this.switchMethod(clickedItemInput.value),items.forEach(item=>{var hipayForm,payzenForm,cards,newCard;item.querySelector(".line")===clickedItem?(item.classList.add("selected"),hipayForm=document.getElementById("payment_form_hipay_hostedfields"),payzenForm=document.getElementById("payment_form_payzen_standard"),window.checkout.setSummaryButton(),selectedPaymentMethodIsHipayHostedFields?(hipayForm&&(hipayForm.style.display="block"),this.handleHostedFields(),cards=Array.prototype.slice.call(item.querySelectorAll(".hipayHF-card")),newCard=Array.prototype.slice.call(item.querySelectorAll(".hipayHF-card-new")),cards.push.apply(cards,newCard),cards.forEach(card=>{card=card.querySelector("input.radio-card");const _this=this;card.addEventListener("change",function(){_this.handleHostedFields()})}),payzenForm&&(payzenForm.style.display="none")):selectedPaymentMethodIsPayzenStandardRest?(hipayForm&&(hipayForm.style.display="none"),this.handlePayzenStandardRest(),payzenForm&&(payzenForm.style.display="block")):(hipayForm&&(hipayForm.style.display="none"),payzenForm&&(payzenForm.style.display="none"))):item.classList.contains("selected")&&item.classList.remove("selected")})},save:function(){checkout.loadWaiting||(this.validate()&&(checkout.setLoadWaiting("payment"),new Ajax.Request(this.saveUrl,{method:"post",onComplete:this.onComplete,onSuccess:this.onSave,onFailure:checkout.ajaxFailure.bind(checkout),parameters:Form.serialize(this.form)})),omnipharAnalyticSavePaymentMethod&&checkout.isOmnipharTagEnabled&&omnipharAnalyticSavePaymentMethod())},resetLoadWaiting:function(){checkout.setLoadWaiting(!1)},nextStep:async function(transport){if(transport&&transport.responseText)try{response=eval("("+transport.responseText+")")}catch(e){response={}}if(response.error)if(response.fields)for(var fields=response.fields.split(","),i=0;i<fields.length;i++){var field=null;(field=$(fields[i]))&&Validation.ajaxError(field,response.error)}else alert(response.error),this.resetLoadWaiting();else{checkout.stepsData[checkout.currentStep].selected_option=this.currentMethod;var data=checkout.stepsData[checkout.currentStep];document.dispatchEvent(new CustomEvent("push_checkout_gtm_event",{detail:{data:data,event:"payment_method_completed"}})),["checkmo","banktransfer"].includes(this.currentMethod)||document.dispatchEvent(new CustomEvent("push_checkout_gtm_event",{detail:{data:data,event:"purchase_attempted"}})),await checkout.reloadProgress(),checkout.setStepResponse(response)}}},Class.create()),rx=(Review.prototype={initialize:function(saveUrl,successUrl,agreementsForm,formPayment){this.formPayment="co-payment-form-review"===formPayment?$(formPayment):null,this.saveUrl=saveUrl,this.successUrl=successUrl,this.agreementsForm=agreementsForm,this.onSave=this.nextStep.bindAsEventListener(this),this.onComplete=this.resetLoadWaiting.bindAsEventListener(this)},save:function(){if(!1===checkout.loadWaiting){if(null!==this.formPayment)if(!new Validation(this.formPayment).validate())return;var params=Form.serialize(payment.form);this.agreementsForm&&(params+="&"+Form.serialize(this.agreementsForm)),params.save=!0,new Ajax.Request(this.saveUrl,{method:"post",parameters:params,onComplete:this.onComplete,onSuccess:this.onSave,onFailure:checkout.ajaxFailure.bind(checkout)})}},resetLoadWaiting:function(transport){try{response=eval("("+transport.responseText+")")}catch(e){response={}}var url=response.redirect;if(url?.include("hostedfields"))return checkout.setLoadWaiting("hostedfields");checkout.setLoadWaiting(!1)},nextStep:function(transport){if(transport&&transport.responseText){var data=checkout.stepsData[checkout.currentStep],url,msg;document.dispatchEvent(new CustomEvent("push_checkout_gtm_event",{detail:{data:data,event:"purchase_attempted"}}));try{response=eval("("+transport.responseText+")")}catch(e){response={}}response.popinUrl&&response.popinData?this.open3DS(response):response.iframeUrl&&response.iframeName&&response.iframeText?(jQuery("body").append('<div id="loader_payment" class="loader-wrapper"><div class="loader-overlay"></div><div class="loader-image"></div><span class="loader-message">'+response.iframeText+"</span></div>"),jQuery("#"+response.iframeName).html('<iframe src="'+response.iframeUrl+'" class="'+response.iframeName+'" onload="var elem = parent.document.getElementById(\'loader_payment\');if (elem) elem.parentNode.removeChild(elem);"/>')):response.redirect?(url=response.redirect,location.href=url):(response.success?window.location=this.successUrl:(msg=response.error_messages,"object"==typeof msg&&(msg=msg.join("\n")),msg&&alert(msg)),response.update_section&&$("checkout-"+response.update_section.name+"-load").update(response.update_section.html),response.goto_section&&checkout.gotoSection(response.goto_section,!0))}},open3DS:function(response){this.modal3DS();var key,hiddenField,formPopin=document.createElement("form"),params=(formPopin.setAttribute("method","POST"),formPopin.setAttribute("action",response.popinUrl),formPopin.setAttribute("id","formIframe3DS"),formPopin.setAttribute("target","3DSecure"),response.popinData);for(key in params)params.hasOwnProperty(key)&&((hiddenField=document.createElement("input")).setAttribute("type","hidden"),hiddenField.setAttribute("name",key),hiddenField.setAttribute("value",params[key]),formPopin.appendChild(hiddenField));document.body.appendChild(formPopin),formPopin.submit(),document.getElementById("formIframe3DS").remove()},modal3DS:function(){Omniphar.modal.show({body:'<iframe name="3DSecure" src="" width="99.6%" height="100%" frameborder="0"></iframe>',callback:function(){doc.getElementById(MODAL_BODY).style.padding=0}})},close3DS:function(){Omniphar.modal.hide()}},/INPUT|SELECT|TEXTAREA/i),SdCheckout=(jQuery(document).bind("keydown keypress",function(e){8!=e.which||rx.test(e.target.tagName)&&!e.target.disabled&&!e.target.readOnly||e.preventDefault()}),document.onmouseover=function(){window.innerDocClick=!0},document.onmouseout=function(){window.innerDocClick=!1},!function(doc,$){$(doc.getElementById("main-content")).on("click","div#cart-sample-link",function(){if(null!==$(document.getElementById("cart_sample_carousel"))){let target=$(document.getElementById("cart_sample_carousel"));setTimeout(function(){goTo(target)},50)}})}(document,jQuery),!function(win,doc,$,om){"use strict";function _pushEvent(_data){var data={eventTrigger:"checkout",ecommerce:{checkout:{actionField:{step:_data.step_number}},page_type:"checkout_"+_data.step}};om.gtm.pushEvent(data),"object"==typeof _data.previousStep&&"string"==typeof _data.previousStep.selected_option&&""!==_data.previousStep.selected_option&&_pushEventOption(_data.previousStep)}function _init(){var checkoutInstance="object"==typeof win.checkout?win.checkout:null;null!==checkoutInstance&&_pushEvent(checkoutInstance.stepsData[checkoutInstance.currentStep]),null!==(checkoutInstance=doc.getElementById("main-content"))&&($(checkoutInstance).on("checkout.init_step",function(e,data){_pushEvent(data)}),document.addEventListener("push_checkout_gtm_event",function(e){var _data;e=e.detail,_data=e.data,e={eventTrigger:e.event,ecommerce:{checkout_option:{actionField:{option:_data.selected_option,step:_data.step_number}}}},om.gtm.pushEvent(e)}),document.addEventListener("push_sign_gtm_event",function(e){e=e.detail,om.gtm.pushEvent({eventTrigger:e})}))}var _pushEventOption=function(_data){_data={eventTrigger:"checkoutOption",ecommerce:{checkout_option:{actionField:{step:_data.step_number,option:_data.selected_option}}}};om.gtm.pushEvent(_data)};$(function(){_init()})}(window,document,jQuery,Omniphar),Class.create(Checkout,{initialize:function($super,accordion,urls){$super(accordion,urls),this.steps=["login","billing","shipping_method","payment","review"]}})),ShippingMethod,shippingMethod,Window=(void 0!==ShippingMethod?ShippingMethod.addMethods({scInit:function(url){this.ScController="/"==url.substr(-1)?url:url+"/",this.ScRequest=null,this.ScPopup=new SoColissimoPopup,this.ScRegexPhone=null,this.ScAction={},this.ScMobile={}},scNext:function(data){this.input.checked=!0,window.shippingMethod.save()},scFailure:function(){checkout.ajaxFailure.bind(checkout)},scBeforeLoadContent:function(){checkout.setLoadWaiting("shipping-method")},scAfterLoadContent:function(){checkout.setLoadWaiting(!1,!1)}}):(ShippingMethod=Class.create(),ShippingMethod.prototype={initialize:function(){},scInit:function(url){this.ScController=url,this.ScRequest=null,this.ScPopup=new SoColissimoPopup,this.ScRegexPhone=null,this.ScAction={},this.ScMobile={},$$(".sp-methods input").each(function(item){item.observe("click",function(event){event=Event.element(event);event.value.match(/socolissimo_/)&&(this.ScPopup.open(920,595),this.scLoadContent("methods",item.serialize().toQueryParams()),event.checked=!1)}.bind(this))}.bind(this))},scNext:function(){window.location.reload()},scFailure:function(){},scBeforeLoadContent:function(){},scAfterLoadContent:function(){}},shippingMethod=new ShippingMethod),ShippingMethod.addMethods({scLoadContent:function(action,parameters){var inputs=document.querySelectorAll("input[value="+parameters.shipping_method+"]");0<inputs.length&&(this.input=inputs[0]),this.ScPopup.closeMessage(),this.scBeforeLoadContent(),this.ScRequest=new Ajax.Request(this.ScController+action,{onLoad:this.ScPopup.loader(Translator.translate("Loading...")),onComplete:function(transport){this.scAfterLoadContent(),transport.getResponseHeader("X-Socolissimo-Message")?(this.ScPopup.show(),this.ScPopup.error(transport.getResponseHeader("X-Socolissimo-Message"))):transport.getResponseHeader("X-Socolissimo-Address")?(this.ScPopup.show(),this.scShowAddress(transport.getResponseHeader("X-Socolissimo-Address"))):transport.getResponseHeader("X-Socolissimo-Save")?(this.ScPopup.close(),this.scAbortRequest(),this.scNext(transport.responseText.evalJSON())):(200==transport.status&&(this.ScPopup.show(),this.ScPopup.update(transport.responseText)),403==transport.status&&this.scFailure())}.bind(this),onFailure:this.scFailure(),parameters:parameters})},scAbortRequest:function(){this.ScRequest&&(this.ScRequest.onreadystatechange=Prototype.emptyFunction,this.ScRequest.transport.abort(),this.ScRequest=null)},scCheckMobile:function(mobile){return!!mobile.replace(/[^+|0-9]/g,"").match(this.ScRegexPhone)},scInitMethods:function(regexPhone){this.ScRegexPhone=regexPhone;var mobile=this.ScMobile,action=this.ScAction;Event.observe($("sc-methods"),"submit",function(event){var selected,select=$$("#sc-methods input[name=method_id]:checked");select.length?(selected=select.first().value,mobile[selected]&&!this.scCheckMobile($$("input[name=mobile]").first().value)?(this.ScPopup.error(Translator.translate("A valid phone number is required.")),$$("input[name=mobile]").first().addClassName("socolissimo-error")):void 0!==action[selected]&&""!==action[selected]&&this.scLoadContent(action[selected],{method_id:select.first().value,mobile:$$("input[name=mobile]").first().value})):this.ScPopup.error(Translator.translate("No shipping method selected, please select a shipping method.")),Event.stop(event)}.bind(this)),$$("input[name=mobile]").first().observe("change",function(event){this.ScPopup.closeMessageWithEffect(),Event.element(event).removeClassName("socolissimo-error")}.bind(this)),$("sc-methods-previous").observe("click",function(event){this.ScPopup.close(),this.scAbortRequest(),window.shippingMethod.resetShippingMethodListToPreviousState()}.bind(this)),$("sc-edit-shipping").observe("click",function(event){this.scAbortRequest(),this.ScRequest=new Ajax.Request(this.ScController+"address",{onLoad:this.ScPopup.loader(),onSuccess:function(transport){this.ScPopup.message(transport.responseText,!1)}.bind(this),onFailure:this.scFailure(),onComplete:this.ScPopup.closeLoader()}),Event.stop(event)}.bind(this)),$$(".sc-method").each(function(item){item.observe("click",function(event){item.hasClassName("disabled")||($("sc-mobile").hide(),mobile[this.previous("input").value]&&$("sc-mobile").show(),$$(".sc-method").each(function(item){item.removeClassName("active")}),this.addClassName("active"),this.previous("input").checked="checked"),Event.stop(event)})}),$$("input[name=method_id]").invoke("observe","click",function(event){event=Event.element(event);$("sc-mobile").hide(),mobile[event.value]&&$("sc-mobile").show(),$$(".sc-method").each(function(item){item.removeClassName("active")}),this.next(".sc-method").addClassName("active")})},scInitShipping:function(){$("sc-shipping-previous").observe("click",function(event){this.ScPopup.closeMessageWithEffect()}.bind(this)),Event.observe($("sc-shipping"),"submit",function(event){var list=document.getElementById("sc-list");if(list){let itemSelected=list.getElementsByClassName("active"),label=(itemSelected=itemSelected.length?itemSelected[0]:itemSelected).getElementsByTagName("label");list=(label=label.length?label[0]:label).cloneNode(!0);list.removeChild(list.firstElementChild),window.shippingMethod.setPickupInfoInItemsList(list.innerHTML)}var postForm=!0,parameters={};$$("#sc-shipping input").each(function(item){parameters[item.name]=item.value,item.hasClassName("required")&&""==item.value&&(item.addClassName("socolissimo-error"),postForm=!1)}),$$("#sc-shipping select").each(function(item){parameters[item.name]=item.value}),postForm&&((list=document.querySelector("ul.shipping-methods li.method.selected input[name=shipping_method]"))&&(list=list.value,parameters.shipping_method=list),this.scLoadContent("saveAddress",parameters)),Event.stop(event)}.bind(this)),$$("#sc-shipping input").each(function(item){item.observe("change",function(event){item.removeClassName("socolissimo-error")})})},scInitAddress:function(){this.scLoadList("list","sc-list"),Event.observe("sc-address","submit",function(event){this.scLoadList("list","sc-list"),Event.stop(event)}.bind(this)),$$("#sc-address input").each(function(item){item.observe("change",function(event){item.removeClassName("socolissimo-error")})})},scLoadList:function(action,element){this.ScPopup.closeMessage(),this.scAbortRequest();var postForm=!0,parameters={};$$("#sc-address input").each(function(item){parameters[item.name]=item.value,item.hasClassName("required")&&""==item.value&&(item.addClassName("socolissimo-error"),postForm=!1)}),$$("#sc-address select").each(function(item){parameters[item.name]=item.value}),postForm&&(this.ScRequest=new Ajax.Request(this.ScController+action,{onLoad:this.ScPopup.loader(Translator.translate("Loading...")),onComplete:function(transport){this.ScPopup.closeLoaderWithEffect(),transport.getResponseHeader("X-Socolissimo-Message")?this.ScPopup.error(transport.getResponseHeader("X-Socolissimo-Message")):$(element).update(transport.responseText)}.bind(this),onFailure:this.scFailure(),parameters:parameters}))},scInitList:function(locations,icon){var googleMap,address;$("sc-list-previous").observe("click",function(event){this.ScPopup.close(),this.scAbortRequest(),window.shippingMethod.resetShippingMethodListToPreviousState()}.bind(this)),locations.length&&$("sc-map")&&((googleMap=new ScGoogleMap("sc-map")).locations(locations,icon),""!=$("sc-input-street").value&&(address="",$$("#sc-address input").each(function(e){address+=e.value+" "}),googleMap.address(address)),$$("#sc-list label").invoke("observe","mouseover",function(event){Event.element(event).up("li").addClassName("hover")}),$$("#sc-list label").invoke("observe","mouseout",function(event){Event.element(event).up("li").removeClassName("hover")}),Event.observe("sc-list","submit",function(event){var select=$$("input[name=relay]:checked"),fromShippingMethod=document.querySelector("#sc-address input[name=from_shipping_method]");if(select.length){var list=document.getElementById("sc-list");if(list){let itemSelected=list.getElementsByClassName("active"),label=(itemSelected=itemSelected.length?itemSelected[0]:itemSelected).getElementsByTagName("label");list=(label=label.length?label[0]:label).cloneNode(!0);list.removeChild(list.firstElementChild),window.shippingMethod.setPickupInfoInItemsList(list.innerHTML)}this.scLoadContent("setLocation",{relay:select.first().value,from_shipping_method:fromShippingMethod.value})}else this.ScPopup.error(Translator.translate("No pickup location has been selected, please select a pickup location."));Event.stop(event)}.bind(this)),$$("#sc-list input").each(function(item){item.observe("click",function(event){googleMap.update(item.id),$$("#sc-list li").each(function(item){item.removeClassName("active")}),item.up("li").addClassName("active")}.bind(this))}.bind(this)),$$("#sc-list label a").invoke("observe","click",function(event){var relayId=Event.element(event).up("label").getAttribute("for"),infoId=Event.element(event).getAttribute("rel");$(infoId)&&locations.each(function(item){if(void 0!==item&&item[3]==relayId)throw this.ScPopup.message($(infoId).innerHTML,!1),this.ScPopup.PopupMessage.select("button").first().observe("click",function(event){this.ScPopup.closeMessageWithEffect()}.bind(this)),$break}.bind(this)),Event.stop(event)}.bind(this)))},scAddAction:function(methodId,action){this.ScAction[methodId]=action},scAddMobile:function(methodId,mobile){this.ScMobile[methodId]=mobile},scShowAddress:function(message){var parameters={};message&&(parameters.message=message),this.scAbortRequest(),this.ScRequest=new Ajax.Request(this.ScController+"address",{onLoad:this.ScPopup.loader(Translator.translate("Loading...")),onSuccess:function(transport){this.ScPopup.message(transport.responseText,!1)}.bind(this),onFailure:this.scFailure(),parameters:parameters})}}),ScGoogleMap=Class.create(),ScGoogleMap.prototype={initialize:function(id){this.infowindow=new google.maps.InfoWindow,this.map=new google.maps.Map(document.getElementById(id),{mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,mapTypeIds:["roadmap","satellite"]}}),this.markers=[]},locations:function(locations,icon){for(var LatLng,googleMap=this,bounds=new google.maps.LatLngBounds,i=0;i<locations.length;i++)void 0!==locations[i]&&(LatLng=new google.maps.LatLng(locations[i][1],locations[i][2]),bounds.extend(LatLng),LatLng=new google.maps.Marker({position:LatLng,map:googleMap.map,icon:icon}),googleMap.markers[locations[i][3]]={content:locations[i][0],marker:LatLng},google.maps.event.addListener(LatLng,"click",function(marker,i){return function(){googleMap.infowindow.setContent(locations[i][0]),googleMap.infowindow.open(googleMap.map,marker),googleMap.select(locations[i][3])}}(LatLng,i)));googleMap.map.fitBounds(bounds)},address:function(address){var googleMap=this;(new google.maps.Geocoder).geocode({address:address},function(results,status){status==google.maps.GeocoderStatus.OK&&new google.maps.Marker({map:googleMap.map,position:results[0].geometry.location})})},select:function(inputId){var list,offsetTopUl,offsetTopLi;$(inputId)&&(inputId=$(inputId),offsetTopUl=(list=$$("#sc-list ul").first()).offsetTop,offsetTopLi=inputId.up("li").offsetTop,$$("#sc-list li").each(function(item){item.removeClassName("active")}),inputId.checked="checked",inputId.up("li").addClassName("active"),list.scrollTop=parseInt(offsetTopLi)-parseInt(offsetTopUl))},update:function(locationId){this.markers[locationId]&&(this.infowindow.setContent(this.markers[locationId].content),this.infowindow.open(this.map,this.markers[locationId].marker))}},SoColissimoPopup=Class.create(),SoColissimoPopup.prototype={initialize:function(){this.PopupContainer=null,this.PopupInner=null,this.PopupMessage=null,this.PopupLoader=null,this.PopupIsMobile=!1},open:function(width,height){var wrapper,e,d;this.PopupContainer&&this.PopupInner||(wrapper=$$(".wrapper-content").first(),this.PopupContainer=new Element("div"),this.PopupContainer.addClassName("socolissimo-popup-container"),this.PopupContainer.setStyle({height:document.viewport.getDimensions().height,cursor:"pointer",display:"none"}),this.PopupContainer.observe("click",function(event){this.close(),window.shippingMethod.resetShippingMethodListToPreviousState()}.bind(this)),this.PopupInner=new Element("div"),this.PopupInner.addClassName("socolissimo-popup-inner"),this.PopupInner.setStyle({height:height+"px",marginTop:-height/2+"px",display:"none"}),height=window,e=(d=document).documentElement,d=d.getElementsByTagName("body")[0],(height.innerWidth||e.clientWidth||d.clientWidth)<=width&&(this.PopupIsMobile=!0,window.scrollTo(0,0),this.PopupInner.setStyle({marginTop:0,top:"44px"})),new Insertion.Before(wrapper,this.PopupContainer),new Insertion.Before(wrapper,this.PopupInner))},show:function(){this.PopupContainer.show(),this.PopupInner.show()},update:function(content){this.closeLoader(),this.PopupInner&&this.PopupInner.update(content),this.PopupIsMobile&&window.scrollTo(0,0)},close:function(){this.PopupInner&&(this.PopupInner.remove(),this.PopupInner=null),this.PopupContainer&&(this.PopupContainer.remove(),this.PopupContainer=null)},error:function(content){this.message('<span class="warning">'+content+"</span>",!0)},message:function(message,close){this.closeLoaderWithEffect(),this.closeMessage(),this.PopupMessage=new Element("div"),this.PopupMessage.addClassName("socolissimo-message"),this.PopupMessage.update(message),new Insertion.Before(this.PopupInner.firstChild,this.PopupMessage);message=parseInt(this.PopupMessage.getHeight())+5;this.PopupMessage.setStyle({marginTop:"-"+message+"px"}),this.PopupIsMobile&&window.scrollTo(0,0),close&&this.PopupMessage.observe("click",function(event){this.closeMessageWithEffect()}.bind(this)),new Effect.Morph(this.PopupMessage,{style:"margin-top:0",duration:.5})},closeMessage:function(){this.PopupMessage&&(this.PopupMessage.remove(),this.PopupMessage=null)},closeMessageWithEffect:function(){var height;this.PopupMessage&&(height=parseInt(this.PopupMessage.getHeight())+5,new Effect.Morph(this.PopupMessage,{style:"margin-top:-"+height+"px",duration:.5,afterFinish:function(){this.closeMessage()}.bind(this)}))},loader:function(){Omniphar.loader.show({message:"Chargement..."})},closeLoader:function(){Omniphar.loader.hide()},closeLoaderWithEffect:function(){Omniphar.loader.hide()}},!function(win,doc,$){"use strict";function _launchTimer(_message){win.clearTimeout(timer),timer=win.setTimeout(function(){win.confirm(_message,void(win.location.href=win.location.protocol+"//"+win.location.host+"/checkout/cart"))},15e5)}var timer=null;$(function(){$(doc.getElementById("main-content")).on("checkout.init_step",function(e,data){"review"===data.step?(data=win.checkout_review_timer.message||"",_launchTimer(data)):win.clearTimeout(timer)})})}(window,document,jQuery),!function(doc,$){$(function(){var main=$(doc.getElementById("main-content"));main.on("click",'button[data-toggle="toggle-details"]',function(){var _elementButton,content;content=(_elementButton=this).parentNode.querySelector("button + div.toggle-details"),_elementButton.classList.contains("show-content")?(_elementButton.classList.remove("show-content"),content.style.display="",content.style.display="none"):(_elementButton.classList.add("show-content"),content.style.display="",content.style.display="block")})})}(document,jQuery),Class.create()),Windows=(Window.keepMultiModalWindow=!1,Window.hasEffectLib="undefined"!=typeof Effect,Window.resizeEffectDuration=.4,Window.prototype={initialize:function(){var a,c,b=0;0<arguments.length&&("string"==typeof arguments[0]?(a=arguments[0],b=1):a=arguments[0]?arguments[0].id:null),a=a||"window_"+(new Date).getTime(),$(a)&&alert("Window "+a+" is already registered in the DOM! Make sure you use setDestroyOnClose() or destroyOnClose: true in the constructor"),this.options=Object.extend({className:"dialog",windowClassName:null,blurClassName:null,minWidth:100,minHeight:20,resizable:!0,closable:!0,minimizable:!0,maximizable:!0,draggable:!0,userData:null,showEffect:Window.hasEffectLib?Effect.Appear:Element.show,hideEffect:Window.hasEffectLib?Effect.Fade:Element.hide,showEffectOptions:{},hideEffectOptions:{},effectOptions:null,parent:document.body,title:"&nbsp;",url:null,onload:Prototype.emptyFunction,width:200,height:300,opacity:1,recenterAuto:!0,wiredDrag:!1,closeOnEsc:!0,closeCallback:null,destroyOnClose:!1,gridX:1,gridY:1},arguments[b]||{}),this.options.blurClassName&&(this.options.focusClassName=this.options.className),void 0===this.options.top&&void 0===this.options.bottom&&(this.options.top=this._round(500*Math.random(),this.options.gridY)),void 0===this.options.left&&void 0===this.options.right&&(this.options.left=this._round(500*Math.random(),this.options.gridX)),this.options.effectOptions&&(Object.extend(this.options.hideEffectOptions,this.options.effectOptions),Object.extend(this.options.showEffectOptions,this.options.effectOptions),this.options.showEffect==Element.Appear)&&(this.options.showEffectOptions.to=this.options.opacity),Window.hasEffectLib&&(this.options.showEffect==Effect.Appear&&(this.options.showEffectOptions.to=this.options.opacity),this.options.hideEffect==Effect.Fade)&&(this.options.hideEffectOptions.from=this.options.opacity),this.options.hideEffect==Element.hide&&(this.options.hideEffect=function(){Element.hide(this.element),this.options.destroyOnClose&&this.destroy()}.bind(this)),this.options.parent!=document.body&&(this.options.parent=$(this.options.parent)),this.element=this._createWindow(a),(this.element.win=this).eventMouseDown=this._initDrag.bindAsEventListener(this),this.eventMouseUp=this._endDrag.bindAsEventListener(this),this.eventMouseMove=this._updateDrag.bindAsEventListener(this),this.eventOnLoad=this._getWindowBorderSize.bindAsEventListener(this),this.eventMouseDownContent=this.toFront.bindAsEventListener(this),this.eventResize=this._recenter.bindAsEventListener(this),this.eventKeyUp=this._keyUp.bindAsEventListener(this),this.topbar=$(this.element.id+"_top"),this.bottombar=$(this.element.id+"_bottom"),this.content=$(this.element.id+"_content"),Event.observe(this.topbar,"mousedown",this.eventMouseDown),Event.observe(this.bottombar,"mousedown",this.eventMouseDown),Event.observe(this.content,"mousedown",this.eventMouseDownContent),Event.observe(window,"load",this.eventOnLoad),Event.observe(window,"resize",this.eventResize),Event.observe(window,"scroll",this.eventResize),Event.observe(document,"keyup",this.eventKeyUp),Event.observe(this.options.parent,"scroll",this.eventResize),this.options.draggable&&([(c=this).topbar,this.topbar.up().previous(),this.topbar.up().next()].each(function(a){a.observe("mousedown",c.eventMouseDown),a.addClassName("top_draggable")}),[this.bottombar.up(),this.bottombar.up().previous(),this.bottombar.up().next()].each(function(a){a.observe("mousedown",c.eventMouseDown),a.addClassName("bottom_draggable")})),this.options.resizable&&(this.sizer=$(this.element.id+"_sizer"),Event.observe(this.sizer,"mousedown",this.eventMouseDown)),this.useTop=this.useLeft=null,void 0!==this.options.left?(this.element.setStyle({left:parseFloat(this.options.left)+"px"}),this.useLeft=!0):(this.element.setStyle({right:parseFloat(this.options.right)+"px"}),this.useLeft=!1),void 0!==this.options.top?(this.element.setStyle({top:parseFloat(this.options.top)+"px"}),this.useTop=!0):(this.element.setStyle({bottom:parseFloat(this.options.bottom)+"px"}),this.useTop=!1),this.storedLocation=null,this.setOpacity(this.options.opacity),this.options.zIndex&&this.setZIndex(this.options.zIndex),this.options.destroyOnClose&&this.setDestroyOnClose(!0),this._getWindowBorderSize(),this.width=this.options.width,this.height=this.options.height,this.constraint=this.visible=!1,this.constraintPad={top:0,left:0,bottom:0,right:0},this.width&&this.height&&this.setSize(this.options.width,this.options.height),this.setTitle(this.options.title),Windows.register(this)},destroy:function(){if(this._notify("onDestroy"),Event.stopObserving(this.topbar,"mousedown",this.eventMouseDown),Event.stopObserving(this.bottombar,"mousedown",this.eventMouseDown),Event.stopObserving(this.content,"mousedown",this.eventMouseDownContent),Event.stopObserving(window,"load",this.eventOnLoad),Event.stopObserving(window,"resize",this.eventResize),Event.stopObserving(window,"scroll",this.eventResize),Event.stopObserving(this.content,"load",this.options.onload),Event.stopObserving(document,"keyup",this.eventKeyUp),this._oldParent){for(var a=this.getContent(),b=null,c=0;c<a.childNodes.length&&1!=(b=a.childNodes[c]).nodeType;c++)b=null;b&&this._oldParent.appendChild(b),this._oldParent=null}this.sizer&&Event.stopObserving(this.sizer,"mousedown",this.eventMouseDown),this.options.url&&(this.content.src=null),this.iefix&&Element.remove(this.iefix),Element.remove(this.element),Windows.unregister(this)},setCloseCallback:function(a){this.options.closeCallback=a},getContent:function(){return this.content},setContent:function(a,b,c){var d=$(a);if(null==d)throw"Unable to find element '"+a+"' in DOM";this._oldParent=d.parentNode;var e=a=null;b&&(a=Element.getDimensions(d)),c&&(e=Position.cumulativeOffset(d)),this.getContent();this.setHTMLContent(""),this.getContent().appendChild(d),d.show(),b&&this.setSize(a.width,a.height),c&&this.setLocation(e[1]-this.heightN,e[0]-this.widthW)},setHTMLContent:function(a){var b;this.options.url&&(this.content.src=null,this.options.url=null,b='<div id="'+this.getId()+'_content" class="'+this.options.className+'_content"> </div>',$(this.getId()+"_table_content").innerHTML=b,this.content=$(this.element.id+"_content")),this.getContent().innerHTML=a},setAjaxContent:function(a,b,c,d){this.showFunction=c?"showCenter":"show",this.showModal=d||!1,b=b||{},this.setHTMLContent(""),this.onComplete=b.onComplete,this._onCompleteHandler||(this._onCompleteHandler=this._setAjaxContent.bind(this)),b.onComplete=this._onCompleteHandler,new Ajax.Request(a,b),b.onComplete=this.onComplete},_setAjaxContent:function(a){Element.update(this.getContent(),a.responseText),this.onComplete&&this.onComplete(a),this.onComplete=null,this[this.showFunction](this.showModal)},setURL:function(a){this.options.url&&(this.content.src=null),this.options.url=a,a="<iframe frameborder='0' name='"+this.getId()+"_content'  id='"+this.getId()+"_content' src='"+a+"' width='"+this.width+"' height='"+this.height+"'> </iframe>",$(this.getId()+"_table_content").innerHTML=a,this.content=$(this.element.id+"_content")},getURL:function(){return this.options.url||null},refresh:function(){this.options.url&&($(this.element.getAttribute("id")+"_content").src=this.options.url)},setCookie:function(a,b,c,d,e){var f;a=a||this.element.id,this.cookie=[a,b,c,d,e],(a=WindowUtilities.getCookie(a))&&(a=(f=a.split(","))[0].split(":"),b=f[1].split(":"),c=parseFloat(f[2]),d=parseFloat(f[3]),e=f[4],f=f[5],this.setSize(c,d),"true"==e?this.doMinimize=!0:"true"==f&&(this.doMaximize=!0),this.useLeft="l"==a[0],this.useTop="t"==b[0],this.element.setStyle(this.useLeft?{left:a[1]}:{right:a[1]}),this.element.setStyle(this.useTop?{top:b[1]}:{bottom:b[1]}))},getId:function(){return this.element.id},setDestroyOnClose:function(){this.options.destroyOnClose=!0},setConstraint:function(a,b){this.constraint=a,this.constraintPad=Object.extend(this.constraintPad,b||{}),this.useTop&&this.useLeft&&this.setLocation(parseFloat(this.element.style.top),parseFloat(this.element.style.left))},_initDrag:function(a){if(!(Event.element(a)==this.sizer&&this.isMinimized()||Event.element(a)!=this.sizer&&this.isMaximized())){if(Prototype.Browser.IE&&0==this.heightN&&this._getWindowBorderSize(),this.pointer=[this._round(Event.pointerX(a),this.options.gridX),this._round(Event.pointerY(a),this.options.gridY)],this.currentDrag=this.options.wiredDrag?this._createWiredElement():this.element,Event.element(a)==this.sizer)this.doResize=!0,this.widthOrg=this.width,this.heightOrg=this.height,this.bottomOrg=parseFloat(this.element.getStyle("bottom")),this.rightOrg=parseFloat(this.element.getStyle("right")),this._notify("onStartResize");else{this.doResize=!1;var b=$(this.getId()+"_close");if(b&&Position.within(b,this.pointer[0],this.pointer[1]))return void(this.currentDrag=null);if(this.toFront(),!this.options.draggable)return;this._notify("onStartMove")}Event.observe(document,"mouseup",this.eventMouseUp,!1),Event.observe(document,"mousemove",this.eventMouseMove,!1),WindowUtilities.disableScreen("__invisible__","__invisible__",this.overlayOpacity),document.body.ondrag=function(){return!1},document.body.onselectstart=function(){return!1},this.currentDrag.show(),Event.stop(a)}},_round:function(a,b){return 1==b?a:Math.floor(a/b)*b},_updateDrag:function(a){var e,b=[this._round(Event.pointerX(a),this.options.gridX),this._round(Event.pointerY(a),this.options.gridY)],c=b[0]-this.pointer[0],d=b[1]-this.pointer[1];this.doResize?(b=this.widthOrg+c,e=this.heightOrg+d,c=this.width-this.widthOrg,d=this.height-this.heightOrg,this.useLeft?b=this._updateWidthConstraint(b):this.currentDrag.setStyle({right:this.rightOrg-c+"px"}),this.useTop?e=this._updateHeightConstraint(e):this.currentDrag.setStyle({bottom:this.bottomOrg-d+"px"}),this.setSize(b,e),this._notify("onResize")):(this.pointer=b,this.useLeft?(c=parseFloat(this.currentDrag.getStyle("left"))+c,b=this._updateLeftConstraint(c),this.pointer[0]+=b-c,this.currentDrag.setStyle({left:b+"px"})):this.currentDrag.setStyle({right:parseFloat(this.currentDrag.getStyle("right"))-c+"px"}),this.useTop?(d=parseFloat(this.currentDrag.getStyle("top"))+d,c=this._updateTopConstraint(d),this.pointer[1]+=c-d,this.currentDrag.setStyle({top:c+"px"})):this.currentDrag.setStyle({bottom:parseFloat(this.currentDrag.getStyle("bottom"))-d+"px"}),this._notify("onMove")),this.iefix&&this._fixIEOverlapping(),this._removeStoreLocation(),Event.stop(a)},_endDrag:function(a){WindowUtilities.enableScreen("__invisible__"),this.doResize?this._notify("onEndResize"):this._notify("onEndMove"),Event.stopObserving(document,"mouseup",this.eventMouseUp,!1),Event.stopObserving(document,"mousemove",this.eventMouseMove,!1),Event.stop(a),this._hideWiredElement(),this._saveCookie(),document.body.ondrag=null,document.body.onselectstart=null},_updateLeftConstraint:function(a){var b;return a=this.constraint&&this.useLeft&&this.useTop&&(b=this.options.parent==document.body?WindowUtilities.getPageSize().windowWidth:this.options.parent.getDimensions().width,(a=a<this.constraintPad.left?this.constraintPad.left:a)+this.width+this.widthE+this.widthW>b-this.constraintPad.right)?b-this.constraintPad.right-this.width-this.widthE-this.widthW:a},_updateTopConstraint:function(a){var b,c;return a=this.constraint&&this.useLeft&&this.useTop&&(b=this.options.parent==document.body?WindowUtilities.getPageSize().windowHeight:this.options.parent.getDimensions().height,c=this.height+this.heightN+this.heightS,(a=a<this.constraintPad.top?this.constraintPad.top:a)+c>b-this.constraintPad.bottom)?b-this.constraintPad.bottom-c:a},_updateWidthConstraint:function(a){var b,c;return a=this.constraint&&this.useLeft&&this.useTop&&(b=this.options.parent==document.body?WindowUtilities.getPageSize().windowWidth:this.options.parent.getDimensions().width,(c=parseFloat(this.element.getStyle("left")))+a+this.widthE+this.widthW>b-this.constraintPad.right)?b-this.constraintPad.right-c-this.widthE-this.widthW:a},_updateHeightConstraint:function(a){var b,c;return a=this.constraint&&this.useLeft&&this.useTop&&(b=this.options.parent==document.body?WindowUtilities.getPageSize().windowHeight:this.options.parent.getDimensions().height,(c=parseFloat(this.element.getStyle("top")))+a+this.heightN+this.heightS>b-this.constraintPad.bottom)?b-this.constraintPad.bottom-c-this.heightN-this.heightS:a},_createWindow:function(a){var b=this.options.className,c=document.createElement("div");return c.setAttribute("id",a),c.className="dialog",this.options.windowClassName&&(c.className+=" "+this.options.windowClassName),c.innerHTML=(this.options.closable?"<div class='"+b+"_close' id='"+a+"_close' onclick='Windows.close(\""+a+"\", event)'> </div>":"")+(this.options.minimizable?"<div class='"+b+"_minimize' id='"+a+"_minimize' onclick='Windows.minimize(\""+a+"\", event)'> </div>":"")+(this.options.maximizable?"<div class='"+b+"_maximize' id='"+a+"_maximize' onclick='Windows.maximize(\""+a+"\", event)'> </div>":"")+"<a href='#' id='"+a+"_focus_anchor'>\x3c!-- --\x3e</a><table id='"+a+"_row1' class=\"top table_window\"><tr><td class='"+b+"_nw'></td><td class='"+b+"_n'><div id='"+a+"_top' class='"+b+"_title title_window'>"+this.options.title+"</div></td><td class='"+b+"_ne'></td></tr></table><table id='"+a+"_row2' class=\"mid table_window\"><tr><td class='"+b+"_w'></td><td id='"+a+"_table_content' class='"+b+"_content' valign='top'>"+(this.options.url?'<iframe frameborder="0" name="'+a+'_content"  id="'+a+'_content" src="'+this.options.url+'"> </iframe>':'<div id="'+a+'_content" class="'+b+'_content"> </div>')+"</td><td class='"+b+"_e'></td></tr></table><table id='"+a+"_row3' class=\"bot table_window\"><tr><td class='"+b+"_sw'></td><td class='"+b+"_s'><div id='"+a+"_bottom' class='status_bar'><span style='float:left; width:1px; height:1px'></span></div></td><td "+(this.options.resizable?"class='"+b+"_sizer' id='"+a+"_sizer'":"class='"+b+"_se'")+"></td></tr></table>",Element.hide(c),this.options.parent.insertBefore(c,this.options.parent.firstChild),Event.observe($(a+"_content"),"load",this.options.onload),c},changeClassName:function(a){var b=this.options.className,c=this.getId();$A(["_close","_minimize","_maximize","_sizer","_content"]).each(function(d){this._toggleClassName($(c+d),b+d,a+d)}.bind(this)),this._toggleClassName($(c+"_top"),b+"_title",a+"_title"),$$("#"+c+" td").each(function(c){c.className=c.className.sub(b,a)}),this.options.className=a},_toggleClassName:function(a,b,c){a&&(a.removeClassName(b),a.addClassName(c))},setLocation:function(a,b){a=this._updateTopConstraint(a),b=this._updateLeftConstraint(b);var c=this.currentDrag||this.element;c.setStyle({top:a+"px"}),c.setStyle({left:b+"px"}),this.useTop=this.useLeft=!0},getLocation:function(){var a={},a=this.useTop?Object.extend(a,{top:this.element.getStyle("top")}):Object.extend(a,{bottom:this.element.getStyle("bottom")});return this.useLeft?Object.extend(a,{left:this.element.getStyle("left")}):Object.extend(a,{right:this.element.getStyle("right")})},getSize:function(){return{width:this.width,height:this.height}},setSize:function(a,b,c){a=parseFloat(a),b=parseFloat(b),!this.minimized&&a<this.options.minWidth&&(a=this.options.minWidth),!this.minimized&&b<this.options.minHeight&&(b=this.options.minHeight),this.options.maxHeight&&b>this.options.maxHeight&&(b=this.options.maxHeight),this.options.maxWidth&&a>this.options.maxWidth&&(a=this.options.maxWidth),this.useTop&&this.useLeft&&Window.hasEffectLib&&Effect.ResizeWindow&&c?new Effect.ResizeWindow(this,null,null,a,b,{duration:Window.resizeEffectDuration}):(this.width=a,this.height=b,(c=this.currentDrag||this.element).setStyle({width:a+this.widthW+this.widthE+"px"}),c.setStyle({height:b+this.heightN+this.heightS+"px"}),this.currentDrag&&this.currentDrag!=this.element||((c=$(this.element.id+"_content")).setStyle({height:b+"px"}),c.setStyle({width:a+"px"})))},updateHeight:function(){this.setSize(this.width,this.content.scrollHeight,!0)},updateWidth:function(){this.setSize(this.content.scrollWidth,this.height,!0)},toFront:function(){this.element.style.zIndex<Windows.maxZIndex&&this.setZIndex(Windows.maxZIndex+1),this.iefix&&this._fixIEOverlapping()},getBounds:function(a){this.width&&this.height&&this.visible||this.computeBounds();var b=this.width,c=this.height;return a||(b+=this.widthW+this.widthE,c+=this.heightN+this.heightS),Object.extend(this.getLocation(),{width:b+"px",height:c+"px"})},computeBounds:function(){var a;this.width&&this.height||(a=WindowUtilities._computeSize(this.content.innerHTML,this.content.id,this.width,this.height,0,this.options.className),this.height?this.width=a+5:this.height=a+5),this.setSize(this.width,this.height),this.centered&&this._center(this.centerTop,this.centerLeft)},show:function(a){if(this.visible=!0,a){var b;if(void 0===this.overlayOpacity)return b=this,void setTimeout(function(){b.show(a)},10);Windows.addModalWindow(this),this.modal=!0,this.setZIndex(Windows.maxZIndex+1),Windows.unsetOverflow(this)}else this.element.style.zIndex||this.setZIndex(Windows.maxZIndex+1);this.oldStyle&&this.getContent().setStyle({overflow:this.oldStyle}),this.computeBounds(),this._notify("onBeforeShow"),this.options.showEffect!=Element.show&&this.options.showEffectOptions?this.options.showEffect(this.element,this.options.showEffectOptions):this.options.showEffect(this.element),this._checkIEOverlapping(),(WindowUtilities.focusedWindow=this)._notify("onShow"),$(this.element.id+"_focus_anchor").focus()},showCenter:function(a,b,c){this.centered=!0,this.centerTop=b,this.centerLeft=c,this.show(a)},isVisible:function(){return this.visible},_center:function(a,b){var c=WindowUtilities.getWindowScroll(this.options.parent),d=WindowUtilities.getPageSize(this.options.parent);void 0===a&&(a=(d.windowHeight-(this.height+this.heightN+this.heightS))/2),a+=c.top,void 0===b&&(b=(d.windowWidth-(this.width+this.widthW+this.widthE))/2),b+=c.left,this.setLocation(a,b),this.toFront()},_recenter:function(a){var b;this.centered&&(a=WindowUtilities.getPageSize(this.options.parent),b=WindowUtilities.getWindowScroll(this.options.parent),this.pageSize&&this.pageSize.windowWidth==a.windowWidth&&this.pageSize.windowHeight==a.windowHeight&&this.windowScroll.left==b.left&&this.windowScroll.top==b.top||(this.pageSize=a,this.windowScroll=b,$("overlay_modal")&&$("overlay_modal").setStyle({height:a.pageHeight+"px"}),this.options.recenterAuto&&this._center(this.centerTop,this.centerLeft)))},hide:function(){this.visible=!1,this.modal&&(Windows.removeModalWindow(this),Windows.resetOverflow()),this.oldStyle=this.getContent().getStyle("overflow")||"auto",this.getContent().setStyle({overflow:"hidden"}),this.options.hideEffect(this.element,this.options.hideEffectOptions),this.iefix&&this.iefix.hide(),this.doNotNotifyHide||this._notify("onHide")},close:function(){var a,b;!this.visible||this.options.closeCallback&&!this.options.closeCallback(this)||(this.options.destroyOnClose&&(a=this.destroy.bind(this),this.options.hideEffectOptions.afterFinish?(b=this.options.hideEffectOptions.afterFinish,this.options.hideEffectOptions.afterFinish=function(){b(),a()}):this.options.hideEffectOptions.afterFinish=function(){a()}),Windows.updateFocusedWindow(),this.doNotNotifyHide=!0,this.hide(),this.doNotNotifyHide=!1,this._notify("onClose"))},minimize:function(){var a,b,c;this.resizing||(a=$(this.getId()+"_row2"),this.minimized?(this.minimized=!1,b=this.r2Height,this.r2Height=null,this.useLeft&&this.useTop&&Window.hasEffectLib&&Effect.ResizeWindow?new Effect.ResizeWindow(this,null,null,null,this.height+b,{duration:Window.resizeEffectDuration}):(c=this.element.getHeight()+b,this.height+=b,this.element.setStyle({height:c+"px"}),a.show()),this.useTop||(a=parseFloat(this.element.getStyle("bottom")),this.element.setStyle({bottom:a-b+"px"})),this.toFront()):(this.minimized=!0,b=a.getDimensions().height,this.r2Height=b,c=this.element.getHeight()-b,this.useLeft&&this.useTop&&Window.hasEffectLib&&Effect.ResizeWindow?new Effect.ResizeWindow(this,null,null,null,this.height-b,{duration:Window.resizeEffectDuration}):(this.height-=b,this.element.setStyle({height:c+"px"}),a.hide()),this.useTop||(a=parseFloat(this.element.getStyle("bottom")),this.element.setStyle({bottom:a+b+"px"}))),this._notify("onMinimize"),this._saveCookie())},maximize:function(){var c,a,d,b;this.isMinimized()||this.resizing||(Prototype.Browser.IE&&0==this.heightN&&this._getWindowBorderSize(),null!=this.storedLocation?(this._restoreLocation(),this.iefix&&this.iefix.hide()):(this._storeLocation(),Windows.unsetOverflow(this),a=WindowUtilities.getWindowScroll(this.options.parent),b=WindowUtilities.getPageSize(this.options.parent),c=a.left,a=a.top,this.options.parent!=document.body&&(c=this.options.parent.getDimensions(),b.windowWidth=c.width,b.windowHeight=c.height,c=a=0),this.constraint&&(b.windowWidth-=Math.max(0,this.constraintPad.left)+Math.max(0,this.constraintPad.right),b.windowHeight-=Math.max(0,this.constraintPad.top)+Math.max(0,this.constraintPad.bottom),c+=Math.max(0,this.constraintPad.left),a+=Math.max(0,this.constraintPad.top)),d=b.windowWidth-this.widthW-this.widthE,b=b.windowHeight-this.heightN-this.heightS,this.useLeft&&this.useTop&&Window.hasEffectLib&&Effect.ResizeWindow?new Effect.ResizeWindow(this,a,c,d,b,{duration:Window.resizeEffectDuration}):(this.setSize(d,b),this.element.setStyle(this.useLeft?{left:c}:{right:c}),this.element.setStyle(this.useTop?{top:a}:{bottom:a})),this.toFront(),this.iefix&&this._fixIEOverlapping()),this._notify("onMaximize"),this._saveCookie())},isMinimized:function(){return this.minimized},isMaximized:function(){return null!=this.storedLocation},setOpacity:function(a){Element.setOpacity&&Element.setOpacity(this.element,a)},setZIndex:function(a){this.element.setStyle({zIndex:a}),Windows.updateZindex(a,this)},setTitle:function(a){a&&""!=a||(a="&nbsp;"),Element.update(this.element.id+"_top",a)},getTitle:function(){return $(this.element.id+"_top").innerHTML},setStatusBar:function(a){$(this.getId()+"_bottom"),"object"==typeof a?this.bottombar.firstChild?this.bottombar.replaceChild(a,this.bottombar.firstChild):this.bottombar.appendChild(a):this.bottombar.innerHTML=a},_checkIEOverlapping:function(){!this.iefix&&0<navigator.appVersion.indexOf("MSIE")&&navigator.userAgent.indexOf("Opera")<0&&"absolute"==this.element.getStyle("position")&&(new Insertion.After(this.element.id,'<iframe id="'+this.element.id+'_iefix" style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" src="javascript:false;" frameborder="0" scrolling="no"></iframe>'),this.iefix=$(this.element.id+"_iefix")),this.iefix&&setTimeout(this._fixIEOverlapping.bind(this),50)},_fixIEOverlapping:function(){Position.clone(this.element,this.iefix),this.iefix.style.zIndex=this.element.style.zIndex-1,this.iefix.show()},_keyUp:function(a){27==a.keyCode&&this.options.closeOnEsc&&this.close()},_getWindowBorderSize:function(a){var b=this._createHiddenDiv(this.options.className+"_n"),c=(this.heightN=Element.getDimensions(b).height,b.parentNode.removeChild(b),b=this._createHiddenDiv(this.options.className+"_s"),this.heightS=Element.getDimensions(b).height,b.parentNode.removeChild(b),b=this._createHiddenDiv(this.options.className+"_e"),this.widthE=Element.getDimensions(b).width,b.parentNode.removeChild(b),b=this._createHiddenDiv(this.options.className+"_w"),this.widthW=Element.getDimensions(b).width,b.parentNode.removeChild(b),(b=document.createElement("div")).className="overlay_"+this.options.className,document.body.appendChild(b),this);setTimeout(function(){c.overlayOpacity=$(b).getStyle("opacity"),b.parentNode.removeChild(b)},10),Prototype.Browser.IE&&(this.heightS=$(this.getId()+"_row3").getDimensions().height,this.heightN=$(this.getId()+"_row1").getDimensions().height),Prototype.Browser.WebKit&&Prototype.Browser.WebKitVersion<420&&this.setSize(this.width,this.height),this.doMaximize&&this.maximize(),this.doMinimize&&this.minimize()},_createHiddenDiv:function(a){var b=document.body,c=document.createElement("div");return c.setAttribute("id",this.element.id+"_tmp"),c.className=a,c.style.display="none",c.innerHTML="",b.insertBefore(c,b.firstChild),c},_storeLocation:function(){null==this.storedLocation&&(this.storedLocation={useTop:this.useTop,useLeft:this.useLeft,top:this.element.getStyle("top"),bottom:this.element.getStyle("bottom"),left:this.element.getStyle("left"),right:this.element.getStyle("right"),width:this.width,height:this.height})},_restoreLocation:function(){null!=this.storedLocation&&(this.useLeft=this.storedLocation.useLeft,this.useTop=this.storedLocation.useTop,this.useLeft&&this.useTop&&Window.hasEffectLib&&Effect.ResizeWindow?new Effect.ResizeWindow(this,this.storedLocation.top,this.storedLocation.left,this.storedLocation.width,this.storedLocation.height,{duration:Window.resizeEffectDuration}):(this.element.setStyle(this.useLeft?{left:this.storedLocation.left}:{right:this.storedLocation.right}),this.element.setStyle(this.useTop?{top:this.storedLocation.top}:{bottom:this.storedLocation.bottom}),this.setSize(this.storedLocation.width,this.storedLocation.height)),Windows.resetOverflow(),this._removeStoreLocation())},_removeStoreLocation:function(){this.storedLocation=null},_saveCookie:function(){var a;this.cookie&&(a="",a=this.useLeft?"l:"+(this.storedLocation?this.storedLocation.left:this.element.getStyle("left")):"r:"+(this.storedLocation?this.storedLocation.right:this.element.getStyle("right")),a=(a=(a=(a=(a=this.useTop?a+",t:"+(this.storedLocation?this.storedLocation.top:this.element.getStyle("top")):a+",b:"+(this.storedLocation?this.storedLocation.bottom:this.element.getStyle("bottom")))+","+(this.storedLocation||this).width)+","+(this.storedLocation||this).height)+","+this.isMinimized())+","+this.isMaximized(),WindowUtilities.setCookie(a,this.cookie))},_createWiredElement:function(){var a;return this.wiredElement||(Prototype.Browser.IE&&this._getWindowBorderSize(),(a=document.createElement("div")).className="wired_frame "+this.options.className+"_wired_frame",a.style.position="absolute",this.options.parent.insertBefore(a,this.options.parent.firstChild),this.wiredElement=$(a)),this.useLeft?this.wiredElement.setStyle({left:this.element.getStyle("left")}):this.wiredElement.setStyle({right:this.element.getStyle("right")}),this.useTop?this.wiredElement.setStyle({top:this.element.getStyle("top")}):this.wiredElement.setStyle({bottom:this.element.getStyle("bottom")}),a=this.element.getDimensions(),this.wiredElement.setStyle({width:a.width+"px",height:a.height+"px"}),this.wiredElement.setStyle({zIndex:Windows.maxZIndex+30}),this.wiredElement},_hideWiredElement:function(){this.wiredElement&&this.currentDrag&&(this.currentDrag==this.element?this.currentDrag=null:(this.useLeft?this.element.setStyle({left:this.currentDrag.getStyle("left")}):this.element.setStyle({right:this.currentDrag.getStyle("right")}),this.useTop?this.element.setStyle({top:this.currentDrag.getStyle("top")}):this.element.setStyle({bottom:this.currentDrag.getStyle("bottom")}),this.currentDrag.hide(),this.currentDrag=null,this.doResize&&this.setSize(this.width,this.height)))},_notify:function(a){this.options[a]?this.options[a](this):Windows.notify(a,this)}},{windows:[],modalWindows:[],observers:[],focusedWindow:null,maxZIndex:0,overlayShowEffectOptions:{duration:.5},overlayHideEffectOptions:{duration:.5},addObserver:function(a){this.removeObserver(a),this.observers.push(a)},removeObserver:function(a){this.observers=this.observers.reject(function(b){return b==a})},notify:function(a,b){this.observers.each(function(c){c[a]&&c[a](a,b)})},getWindow:function(a){return this.windows.detect(function(b){return b.getId()==a})},getFocusedWindow:function(){return this.focusedWindow},updateFocusedWindow:function(){this.focusedWindow=2<=this.windows.length?this.windows[this.windows.length-2]:null},register:function(a){this.windows.push(a)},addModalWindow:function(a){0==this.modalWindows.length?WindowUtilities.disableScreen(a.options.className,"overlay_modal",a.overlayOpacity,a.getId(),a.options.parent):(Window.keepMultiModalWindow?($("overlay_modal").style.zIndex=Windows.maxZIndex+1,Windows.maxZIndex+=1,WindowUtilities._hideSelect(this.modalWindows.last().getId())):this.modalWindows.last().element.hide(),WindowUtilities._showSelect(a.getId())),this.modalWindows.push(a)},removeModalWindow:function(a){this.modalWindows.pop(),0==this.modalWindows.length?WindowUtilities.enableScreen():Window.keepMultiModalWindow?(this.modalWindows.last().toFront(),WindowUtilities._showSelect(this.modalWindows.last().getId())):this.modalWindows.last().element.show()},unregister:function(a){this.windows=this.windows.reject(function(b){return b==a})},closeAll:function(){this.windows.each(function(a){Windows.close(a.getId())})},closeAllModalWindows:function(){WindowUtilities.enableScreen(),this.modalWindows.each(function(a){a&&a.close()})},minimize:function(a,b){a=this.getWindow(a);a&&a.visible&&a.minimize(),Event.stop(b)},maximize:function(a,b){a=this.getWindow(a);a&&a.visible&&a.maximize(),Event.stop(b)},close:function(a,b){a=this.getWindow(a);a&&a.close(),b&&Event.stop(b)},blur:function(a){(a=this.getWindow(a))&&(a.options.blurClassName&&a.changeClassName(a.options.blurClassName),this.focusedWindow==a&&(this.focusedWindow=null),a._notify("onBlur"))},focus:function(a){(a=this.getWindow(a))&&(this.focusedWindow&&this.blur(this.focusedWindow.getId()),a.options.focusClassName&&a.changeClassName(a.options.focusClassName),(this.focusedWindow=a)._notify("onFocus"))},unsetOverflow:function(a){this.windows.each(function(a){a.oldOverflow=a.getContent().getStyle("overflow")||"auto",a.getContent().setStyle({overflow:"hidden"})}),a&&a.oldOverflow&&a.getContent().setStyle({overflow:a.oldOverflow})},resetOverflow:function(){this.windows.each(function(a){a.oldOverflow&&a.getContent().setStyle({overflow:a.oldOverflow})})},updateZindex:function(a,b){a>this.maxZIndex&&(this.maxZIndex=a,this.focusedWindow)&&this.blur(this.focusedWindow.getId()),(this.focusedWindow=b)&&this.focus(this.focusedWindow.getId())}}),Dialog={dialogId:null,onCompleteFunc:null,callFunc:null,parameters:null,confirm:function(a,b){var c,d;if(!a||"string"==typeof a)return a=a||"",c=(b=b||{}).okLabel||"Ok",d=b.cancelLabel||"Cancel",(b=Object.extend(b,b.windowParameters||{})).windowParameters=b.windowParameters||{},b.className=b.className||"alert",a="<div class='"+b.className+"_message'>"+a+"</div><div class='"+b.className+"_buttons'><button type='button' title='"+c+"' onclick='Dialog.okCallback()' class ='"+(b.buttonClass?b.buttonClass+" ":"")+" ok_button'><span><span><span>"+c+"</span></span></span></button><button type='button' title='"+d+"' onclick='Dialog.cancelCallback()' class ='"+(b.buttonClass?b.buttonClass+" ":"")+" cancel_button'><span><span><span>"+d+"</span></span></span></button></div>",this._openDialog(a,b);Dialog._runAjaxRequest(a,b,Dialog.confirm)},alert:function(a,b){var c;if(!a||"string"==typeof a)return a=a||"",c=(b=b||{}).okLabel||"Ok",(b=Object.extend(b,b.windowParameters||{})).windowParameters=b.windowParameters||{},b.className=b.className||"alert",a="<div class='"+b.className+"_message'>"+a+"</div><div class='"+b.className+"_buttons'><button type='button' title='"+c+"' onclick='Dialog.okCallback()' class ='"+(b.buttonClass?b.buttonClass+" ":"")+" ok_button'><span><span><span>"+c+"</span></span></span></button></div>",this._openDialog(a,b);Dialog._runAjaxRequest(a,b,Dialog.alert)},info:function(a,b){if(!a||"string"==typeof a)return a=a||"",b=b||{},(b=Object.extend(b,b.windowParameters||{})).windowParameters=b.windowParameters||{},b.className=b.className||"alert",a="<div id='modal_dialog_message' class='"+b.className+"_message'>"+a+"</div>",b.showProgress&&(a+="<div id='modal_dialog_progress' class='"+b.className+"_progress'>  </div>"),b.ok=null,b.cancel=null,this._openDialog(a,b);Dialog._runAjaxRequest(a,b,Dialog.info)},setInfoMessage:function(a){$("modal_dialog_message").update(a)},closeInfo:function(){Windows.close(this.dialogId)},_openDialog:function(a,b){var c=b.className;return b.height||b.width||(b.width=WindowUtilities.getPageSize(b.options.parent||document.body).pageWidth/2),b.id?this.dialogId=b.id:(this.dialogId="modal_dialog_"+(new Date).getTime(),b.id=this.dialogId),b.height&&b.width||(c=WindowUtilities._computeSize(a,this.dialogId,b.width,b.height,5,c),b.height?b.width=c+5:b.height=c+5),b.effectOptions=b.effectOptions,b.resizable=b.resizable||!1,b.minimizable=b.minimizable||!1,b.maximizable=b.maximizable||!1,b.draggable=b.draggable||!1,b.closable=b.closable||!1,(c=new Window(b)).getContent().innerHTML=a,c.showCenter(!0,b.top,b.left),c.setDestroyOnClose(),c.cancelCallback=b.onCancel||b.cancel,c.okCallback=b.onOk||b.ok,c},_getAjaxContent:function(a){Dialog.callFunc(a.responseText,Dialog.parameters)},_runAjaxRequest:function(a,b,c){null==a.options&&(a.options={}),Dialog.onCompleteFunc=a.options.onComplete,Dialog.parameters=b,Dialog.callFunc=c,a.options.onComplete=Dialog._getAjaxContent,new Ajax.Request(a.url,a.options)},okCallback:function(){var a=Windows.focusedWindow;a.okCallback&&!a.okCallback(a)||($$("#"+a.getId()+" input").each(function(a){a.onclick=null}),a.close())},cancelCallback:function(){var a=Windows.focusedWindow;$$("#"+a.getId()+" input").each(function(a){a.onclick=null}),a.close(),a.cancelCallback&&a.cancelCallback(a)}},array,WindowUtilities=(Prototype.Browser.WebKit&&(array=navigator.userAgent.match(new RegExp(/AppleWebKit\/([\d\.\+]*)/)),Prototype.Browser.WebKitVersion=parseFloat(array[1])),{getWindowScroll:function(a){var b,c,d;if(a=a||document.body,a!=document.body)b=a.scrollTop,c=a.scrollLeft,d=a.scrollWidth,a=a.scrollHeight;else with(a=window,a.document)a.document.documentElement&&documentElement.scrollTop?(b=documentElement.scrollTop,c=documentElement.scrollLeft):a.document.body&&(b=body.scrollTop,c=body.scrollLeft),a=a.innerWidth?(d=a.innerWidth,a.innerHeight):a.document.documentElement&&documentElement.clientWidth?(d=documentElement.clientWidth,documentElement.clientHeight):(d=body.offsetWidth,body.offsetHeight);return{top:b,left:c,width:d,height:a}},getPageSize:function(a){var b,c,d;return(a=a||document.body)!=document.body?(b=a.getWidth(),c=a.getHeight(),d=a.scrollWidth,a=a.scrollHeight):(a=window.innerHeight&&window.scrollMaxY?(d=document.body.scrollWidth,window.innerHeight+window.scrollMaxY):document.body.scrollHeight>document.body.offsetHeight?(d=document.body.scrollWidth,document.body.scrollHeight):(d=document.body.offsetWidth,document.body.offsetHeight),self.innerHeight?(b=document.documentElement.clientWidth,c=self.innerHeight):document.documentElement&&document.documentElement.clientHeight?(b=document.documentElement.clientWidth,c=document.documentElement.clientHeight):document.body&&(b=document.body.clientWidth,c=document.body.clientHeight),a=a<c?c:a,d=d<b?b:d),{pageWidth:d,pageHeight:a,windowWidth:b,windowHeight:c}},disableScreen:function(a,b,c,d,e){WindowUtilities.initLightbox(b,a,function(){this._disableScreen(a,b,c,d)}.bind(this),e||document.body)},_disableScreen:function(a,b,c,d){a=$(b);var e=WindowUtilities.getPageSize(a.parentNode);d&&Prototype.Browser.IE&&(WindowUtilities._hideSelect(),WindowUtilities._showSelect(d)),a.style.height=e.pageHeight+"px",a.style.display="none","overlay_modal"==b&&Window.hasEffectLib&&Windows.overlayShowEffectOptions?(a.overlayOpacity=c,new Effect.Appear(a,Object.extend({from:0,to:c},Windows.overlayShowEffectOptions))):a.style.display="block"},enableScreen:function(a){a=a||"overlay_modal";var b=$(a);b&&("overlay_modal"==a&&Window.hasEffectLib&&Windows.overlayHideEffectOptions?new Effect.Fade(b,Object.extend({from:b.overlayOpacity,to:0},Windows.overlayHideEffectOptions)):(b.style.display="none",b.parentNode.removeChild(b)),"__invisible__"!=a)&&WindowUtilities._showSelect()},_hideSelect:function(a){Prototype.Browser.IE&&$$((null==a?"":"#"+a+" ")+"select").each(function(a){WindowUtilities.isDefined(a.oldVisibility)||(a.oldVisibility=a.style.visibility||"visible",a.style.visibility="hidden")})},_showSelect:function(a){Prototype.Browser.IE&&$$((null==a?"":"#"+a+" ")+"select").each(function(a){if(WindowUtilities.isDefined(a.oldVisibility)){try{a.style.visibility=a.oldVisibility}catch(c){a.style.visibility="visible"}a.oldVisibility=null}else a.style.visibility&&(a.style.visibility="visible")})},isDefined:function(a){return void 0!==a&&null!=a},initLightbox:function(a,b,c,d){var e;$(a)?(Element.setStyle(a,{zIndex:Windows.maxZIndex+1}),Windows.maxZIndex++,c()):((e=document.createElement("div")).setAttribute("id",a),e.className="overlay_"+b,e.style.display="none",e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.zIndex=Windows.maxZIndex+1,Windows.maxZIndex++,e.style.width="100%",d.insertBefore(e,d.firstChild),Prototype.Browser.WebKit&&"overlay_modal"==a?setTimeout(function(){c()},10):c())},setCookie:function(a,b){document.cookie=b[0]+"="+escape(a)+(b[1]?"; expires="+b[1].toGMTString():"")+(b[2]?"; path="+b[2]:"")+(b[3]?"; domain="+b[3]:"")+(b[4]?"; secure":"")},getCookie:function(a){var b=document.cookie,c=b.indexOf("; "+(a+="="));if(-1==c){if(0!=(c=b.indexOf(a)))return null}else c+=2;var d=document.cookie.indexOf(";",c);return-1==d&&(d=b.length),unescape(b.substring(c+a.length,d))},_computeSize:function(a,b,c,d,e,f){var h=document.body,g=document.createElement("div");return g.setAttribute("id",b),g.className=f+"_content",d?g.style.height=d+"px":g.style.width=c+"px",g.style.position="absolute",g.style.top="0",g.style.left="0",g.style.display="none",g.innerHTML=a,h.insertBefore(g,h.firstChild),a=d?$(g).getDimensions().width+e:$(g).getDimensions().height+e,h.removeChild(g),a}});